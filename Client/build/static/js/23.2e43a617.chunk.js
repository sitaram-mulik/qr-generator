"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[23],{5210:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Z});var s=n(9379),a=n(9950),o=n(1129),i=n(7356),l=n(615),c=n(7321),r=n(6503),u=n(6057),d=n(3711),m=n(6253),h=n(6559),x=n(8796),p=n(9810),g=n(2438),A=n(7113),v=n(4941),y=n.n(v);n(5392);const f=n.p+"static/media/location.688d9819f1dcac68f5f36a7a231f3140.svg";var j=n(4414);const b=e=>{let{locations:t=[]}=e;if(!t.length)return null;const{lat:n,lng:s}=t[0],a=new L.Icon({iconUrl:f,iconSize:new L.Point(40,47)});return t[0]&&(0,j.jsxs)(p.W,{style:{height:"500px",minWidth:"300px"},center:[n,s],zoom:2,scrollWheelZoom:!0,children:[(0,j.jsx)(g.e,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,j.jsx)(y(),{children:t.map(((e,t)=>(0,j.jsx)(A.p,{icon:a,position:[e.lat,e.lng]},t)))})]})};var C=n(9964);const w=e=>{let{topCountries:t,topCities:n}=e;console.log("topCountries ",t);const s=(0,i.A)(),a=(0,l.A)(s.breakpoints.up("md")),o=t.map((e=>e.country)),r=t.map((e=>e.count)),u=n.map((e=>e.city||e.cities)),d=n.map((e=>e.count));return(0,j.jsx)(m.A,{item:!0,xs:12,children:(0,j.jsxs)(x.A,{sx:{p:2},children:[t.length>0&&(0,j.jsx)(c.A,{mb:4,children:(0,j.jsx)(C.E,{xAxis:[{data:r,label:"count"}],yAxis:[{scaleType:"band",data:o}],series:[{data:r,label:"Top Countries"}],layout:"horizontal",width:a?500:300,height:Math.max(200,40*o.length),sx:{".MuiBarElement-root":{fill:"#1976d2"}}})}),n.length>0&&(0,j.jsx)(c.A,{children:(0,j.jsx)(C.E,{xAxis:[{data:d,label:"count"}],yAxis:[{scaleType:"band",data:u}],series:[{data:d,label:"Top Cities"}],layout:"horizontal",width:a?500:300,height:Math.max(200,40*u.length),sx:{".MuiBarElement-root":{fill:"#388e3c"}}})})]})})},S=e=>{let{selectedCampaign:t}=e;const[n,s]=(0,a.useState)([]),[i,l]=(0,a.useState)("India"),[c,r]=(0,a.useState)(!0),[u,d]=(0,a.useState)();(0,a.useEffect)((()=>{(async()=>{try{r(!0);const e=await o.A.get("/locations?campaign=".concat(t));console.log("locationsRes.data ",e.data);const n=[...e.data];s(n),r(!1)}catch(e){d("Failed to load location data ",e),r(!1)}})()}),[t]),console.log("locations ",n);const h=(0,a.useMemo)((()=>n.reduce(((e,t)=>{const n=t.country&&"unknown"!==t.country?t.country:"Anonymous";return e[n]=(e[n]||0)+1,e}),{})),[n]),p=(0,a.useMemo)((()=>n.filter((e=>e.city)).reduce(((e,t)=>{const n=t.city||"Anonymous";return e[n]=(e[n]||0)+1,e}),{})),[n]),g=(0,a.useMemo)((()=>{const e=[];return n.forEach((t=>{if(!t.ll)return;const[n,s]=JSON.parse(t.ll);e.push({lat:n,lng:s})})),e||[]}),[n]),A=(0,a.useMemo)((()=>{console.log("countryData ",h);const e=Object.entries(h).sort(((e,t)=>t[1]-e[1])).slice(0,5).map((e=>{let[t,n]=e;return{country:t,count:n}}));return e}),[h]),v=(0,a.useMemo)((()=>{console.log("cityData ",p);return Object.entries(p).sort(((e,t)=>t[1]-e[1])).slice(0,5).map((e=>{let[t,n]=e;return{city:t,count:n}}))}),[p]);return!c&&g.length>0&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(w,{topCountries:A,topCities:v}),(0,j.jsx)(m.A,{item:!0,size:{xs:12,md:8},children:(0,j.jsx)(x.A,{sx:{p:2},children:(0,j.jsx)(b,{locations:g})})})]})};var M=n(5547),k=n(900);const D=e=>{let{stats:t}=e;return(0,j.jsx)(c.A,{sx:{display:"flex",justifyContent:"space-between",width:{md:"50%",xs:"100%"},mb:{xs:2,md:0}},children:t.map(((e,t)=>(0,j.jsxs)(M.A,{sx:{p:{xs:1,sm:2},textAlign:"center",borderRadius:2,boxShadow:2,width:"24%"},children:[(0,j.jsx)(k.A,{variant:"subtitle2",sx:{fontSize:{xs:"0.8rem",sm:"1rem"}},color:"text.secondary",children:e.label}),(0,j.jsx)(k.A,{variant:"h6",sx:{fontSize:{xs:"1.2rem",sm:"1.5rem"}},fontWeight:"bold",children:e.value})]},e.label)))})};var E=n(4666),z=n(4837);const O=e=>{let{setCampaignsData:t}=e;const[n,s]=(0,a.useState)([]),[i]=(0,h.ok)(),l=i.get("campaign"),c=(0,h.Zp)();(0,a.useEffect)((()=>{r()}),[]);const r=async()=>{try{const e=await o.A.get("/campaigns");s(e.data),t(e.data)}catch(e){console.log("Failed to load campaigns ",e)}};return(0,j.jsxs)(E.A,{select:!0,label:"Select Campaign",value:l,onChange:e=>{return t=e.target.value,void c("?campaign=".concat(t||"all"));var t},required:!0,sx:{minWidth:300},children:[(0,j.jsx)(z.A,{value:"all",children:"All"},"all"),n.map((e=>{let{name:t,_id:n}=e;return(0,j.jsx)(z.A,{value:t,children:t},n)}))]})},W=(0,a.memo)(O);var T=n(3673);const F=e=>{let{selectedCampaign:t}=e;const[n,s]=(0,a.useState)({labels:[],series:[]});(0,a.useEffect)((()=>{t&&i()}),[t]);const i=async()=>{try{const e=(await o.A.get("/assets?campaign="+t+"&verified=true")).data.assets,n=e=>e.reduce(((e,t)=>{const n=new Date(t.verifiedAt).toISOString().slice(0,10);return e[n]=(e[n]||0)+1,e}),{});let a=(e=>e.reduce(((e,t)=>{const n=new Date(t.verifiedAt).toISOString().slice(0,13);return e[n]=(e[n]||0)+1,e}),{}))(e),i=Object.keys(a).sort();if(i.length>100){const t=n(e);i=Object.keys(t).sort(),a=t}const l=i.map((e=>a[e])),c=e=>{let t;return 10===e.length?(t=new Date(e),t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})):13===e.length?(t=new Date(e+":00:00Z"),t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):(t=new Date(e),t.toLocaleString())};let r=i.map(c);if(r.length>=1){const e=new Date(new Date(r[0]).getTime()-36e5);r=[e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),...r],l.unshift(0)}s({labels:r,series:l})}catch(e){console.log("error ",e)}};return n.labels.length>0&&(0,j.jsx)(x.A,{sx:{p:2,mt:2},children:(0,j.jsx)(T.b,{xAxis:[{scaleType:"point",data:n.labels}],series:[{data:n.series,area:!0,label:"Scanned Assets"}],height:400,sx:{".MuiLineElement-root":{strokeWidth:3},".MuiAreaElement-root":{opacity:.2}}})})};var I=n(6997);const R=e=>{let{counts:t}=e;const[n,s]=(0,a.useState)([]);return(0,a.useEffect)((()=>{const{verifiedCount:e,totalCount:n}=t||{},a=e||0,o=n?Math.max(n-a,0):0;s([{label:"Scanned",value:a},{label:"Remaining",value:o}])}),[t]),t.verifiedCount>0&&(0,j.jsx)(x.A,{sx:{p:2,mt:2},children:(0,j.jsx)(I.r,{height:300,width:300,series:[{data:n,innerRadius:"50%",arcLabelMinAngle:20}],skipAnimation:!1})})},Z=()=>{const[e,t]=(0,a.useState)({totalCount:0,downloadedCount:0,verifiedCount:0,campaignCount:0}),[n,x]=(0,a.useState)(!0),[p,g]=(0,a.useState)(null),A=((0,h.Zp)(),(0,i.A)()),[v]=((0,l.A)(A.breakpoints.down("sm")),(0,h.ok)()),y=v.get("campaign")||"all";(0,a.useEffect)((()=>{(async()=>{try{x(!0);const e=await o.A.get("/assets/statistics?campaign=".concat(y)),{totalCount:n,downloadedCount:s,verifiedCount:a}=(null===e||void 0===e?void 0:e.data)||{};t({totalCount:n,downloadedCount:s,verifiedCount:a}),x(!1)}catch(e){g("Failed to load statistics"),x(!1)}})()}),[y]);const f=(0,a.useMemo)((()=>[{label:"Campaigns",value:(null===e||void 0===e?void 0:e.campaignCount)||0},{label:"Assets",value:(null===e||void 0===e?void 0:e.totalCount)||0},{label:"Scans",value:(null===e||void 0===e?void 0:e.verifiedCount)||0},{label:"Downloads",value:(null===e||void 0===e?void 0:e.downloadedCount)||0}]),[e]),b=(0,a.useCallback)((e=>{console.log("campaignscampaigns ",e),t((t=>(0,s.A)((0,s.A)({},t),{},{campaignCount:(null===e||void 0===e?void 0:e.length)||0})))}),[]);return n?(0,j.jsx)(c.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,j.jsx)(r.A,{})}):p?(0,j.jsx)(u.A,{severity:"error",sx:{m:3},children:p}):(0,j.jsxs)(d.A,{maxWidth:!1,sx:{p:2},children:[(0,j.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",flexDirection:{xs:"column",md:"row"}},children:[(0,j.jsx)(D,{stats:f||[]}),(0,j.jsx)(W,{setCampaignsData:b})]}),(0,j.jsxs)(m.A,{container:!0,spacing:3,children:[(0,j.jsx)(m.A,{size:{xs:12,md:8},children:(0,j.jsx)(F,{selectedCampaign:y})}),(0,j.jsx)(m.A,{size:{xs:12,md:4},children:(0,j.jsx)(R,{counts:e})}),(0,j.jsx)(S,{selectedCampaign:y,counts:e})]})]})}}}]);