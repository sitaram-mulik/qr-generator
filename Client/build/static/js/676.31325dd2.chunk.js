"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[676],{1676:(e,s,t)=>{t.r(s),t.d(s,{default:()=>H});var a=t(9379),n=t(9950),l=t(1129),c=t(3711),i=t(8506),r=t(8796),o=t(7321),d=t(4666),h=t(6615),x=t(5547),A=t(2036),u=t(6057),m=t(5269),j=t(7631),p=t(943),g=t(3588),f=t(8767),v=t(9172),w=t(1500),y=(t(5052),t(1751)),b=t(2026),S=t(7356),C=t(615),k=t(4837),L=t(5827),E=t(4351),F=t(5250),R=t(7371),U=t(4414);const D=e=>{let{filters:s,onFilterChange:t}=e;const[a,c]=(0,n.useState)([]),[i,r]=(0,n.useState)(!1),x=(0,S.A)(),A=(0,C.A)(x.breakpoints.down("sm"));(0,n.useEffect)((()=>{(async()=>{try{const e=await l.A.get("/campaigns");c(e.data)}catch(e){console.log("Failed to fetch campaign options:",e)}})()}),[]);const u=()=>{r(!0)},m=()=>{r(!1)},j=(0,U.jsxs)(o.A,{sx:{display:"flex",flexDirection:A?"column":"row",alignItems:"center",gap:2,mb:2},children:[(0,U.jsxs)(d.A,{select:!0,label:"By Campaign",value:s.campaign||"",onChange:e=>t("campaign",e.target.value),sx:{minWidth:200},children:[(0,U.jsx)(k.A,{value:"",children:"All Campaigns"}),a.map((e=>(0,U.jsx)(k.A,{value:e.name,children:e.name},e.id)))]}),(0,U.jsxs)(d.A,{select:!0,label:"By Scan",value:s.verified||"",onChange:e=>t("verified",e.target.value),sx:{minWidth:200},children:[(0,U.jsx)(k.A,{value:"",children:"All"}),(0,U.jsx)(k.A,{value:"true",children:"Scanned"}),(0,U.jsx)(k.A,{value:"false",children:"Not scanned"})]}),(0,U.jsxs)(d.A,{select:!0,label:"By Downloads",value:s.downloaded||"",onChange:e=>t("downloaded",e.target.value),sx:{minWidth:200},children:[(0,U.jsx)(k.A,{value:"",children:"All"}),(0,U.jsx)(k.A,{value:"true",children:"Downloaded"}),(0,U.jsx)(k.A,{value:"false",children:"Not downloaded"})]}),(0,U.jsx)(d.A,{label:"Filter by Created After",type:"date",value:s.createdAfter||"",onChange:e=>t("createdAfter",e.target.value),sx:{minWidth:200},InputLabelProps:{shrink:!0}})]});return A?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(h.A,{variant:"outlined",onClick:u,sx:{mb:2},children:"Filters"}),(0,U.jsxs)(L.A,{open:i,onClose:m,fullWidth:!0,maxWidth:"sm",children:[(0,U.jsx)(E.A,{children:"Filters"}),(0,U.jsx)(F.A,{children:j}),(0,U.jsx)(R.A,{children:(0,U.jsx)(h.A,{onClick:m,children:"Close"})})]})]}):j};var W=t(6559),I=t(8728),T=t.n(I),N=t(8703),P=t(9872),z=t(5532);const O={campaign:"",verified:"",downloaded:""};function B(e,s){return"SET_FILTERS"===s.type?(0,a.A)((0,a.A)({},e),s.payload):e}const H=function(){const[e,s]=(0,n.useState)(!0),[t,S]=(0,n.useState)(null),[C,k]=(0,n.useState)([]),[L,E]=(0,n.useState)([]),[F,R]=(0,n.useState)(!1),[I,H]=(0,n.useState)(null),[V,_]=(0,n.useReducer)(B,O),J=(0,W.zy)(),Z=(0,W.Zp)(),{fetchUserDetails:q}=(0,n.useContext)(z.c);(0,n.useEffect)((()=>{const e=new URLSearchParams(J.search),s=Object.fromEntries(e.entries());_({type:"SET_FILTERS",payload:(0,a.A)({},s)})}),[J.search]),(0,n.useEffect)((()=>{G()}),[V]);const G=async()=>{try{const e=new URLSearchParams(J.search),t=await l.A.get("/assets?".concat(e.toString()));k(t.data.assets),E(t.data.count),s(!1)}catch(e){S("Failed to load code list "),s(!1)}};return e?(0,U.jsx)(c.A,{maxWidth:"lg",sx:{mt:4},children:(0,U.jsx)(i.A,{})}):(0,U.jsxs)(c.A,{maxWidth:"lg",sx:{mt:4},children:[(0,U.jsxs)(r.A,{sx:{p:3},children:[(0,U.jsxs)(o.A,{sx:{mb:4},children:[(0,U.jsx)(D,{filters:V,onFilterChange:(e,s)=>{const t=new URLSearchParams(J.search);void 0===typeof s||""===s?t.delete(e):t.set(e,s),Z("".concat(J.pathname,"?").concat(t.toString()),{replace:!0})}}),(0,U.jsxs)(o.A,{sx:{mb:1},align:"left",children:[(0,U.jsx)(d.A,{label:"Download count",type:"number",value:L,onChange:e=>E(e.target.value),size:"small",sx:{mb:2,mr:2}}),(0,U.jsx)(h.A,{variant:"contained",startIcon:(0,U.jsx)(y.A,{}),onClick:async()=>{R(!0),H(null);try{var e;const s=new URLSearchParams(J.search);s.append("count",L);const t=(await(0,l.A)("/assets/download?".concat(s.toString()),{responseType:"blob"})).data,a=window.URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="".concat(V.campaign||"all","-assets.zip"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a);const c=await T().loadAsync(t),i=await(null===(e=c.file("summary.json"))||void 0===e?void 0:e.async("string"));if(i){const e=JSON.parse(i);R(!1),H(e)}q()}catch(t){return S("Failed to download assets ",t),R(!1),void q()}},children:"Download assets"})]}),I&&!F&&(0,U.jsx)(x.A,{children:(0,U.jsx)(A.A,{children:(0,U.jsx)(o.A,{sx:{mb:2},children:(0,U.jsxs)(u.A,{severity:I.failed>0?"warning":"success",sx:{mt:2},children:["Last download status: ",I.success," successful,"," ",I.failure," failed (Total: ",I.total,")"]})})})})]}),(0,U.jsx)(m.A,{component:o.A,sx:{maxHeight:440},children:(0,U.jsxs)(j.A,{stickyHeader:!0,"aria-label":"assets table",size:"small",children:[(0,U.jsx)(p.A,{children:(0,U.jsxs)(g.A,{children:[(0,U.jsx)(f.A,{children:"Id"}),(0,U.jsx)(f.A,{children:"Campaign"}),(0,U.jsx)(f.A,{children:"Verified at"}),(0,U.jsx)(f.A,{children:"Downloads"}),(0,U.jsx)(f.A,{children:"Created at"}),(0,U.jsx)(f.A,{align:"right",children:"View"})]})}),(0,U.jsx)(v.A,{children:C.map((e=>(0,U.jsxs)(g.A,{hover:!0,children:[(0,U.jsx)(f.A,{component:"th",scope:"row",children:e.code}),(0,U.jsx)(f.A,{component:"th",scope:"row",children:e.campaign}),(0,U.jsx)(f.A,{component:"th",scope:"row",children:e.verifiedAt?(0,b.E)(e.verifiedAt):"Not verified"}),(0,U.jsx)(f.A,{component:"th",scope:"row",children:e.downloads}),(0,U.jsx)(f.A,{component:"th",scope:"row",children:(0,b.E)(e.createdAt)}),(0,U.jsx)(f.A,{align:"right",children:(0,U.jsx)(w.A,{color:"primary",onClick:()=>Z("/assets/code/".concat(e.code)),children:(0,U.jsx)(P.A,{})})})]},e.code)))})]})}),t&&(0,U.jsx)(u.A,{severity:"error",sx:{mt:2},children:t}),0===C.length&&(0,U.jsx)(u.A,{severity:"info",sx:{mt:2},children:"No matching assets found for this filter."})]}),(0,U.jsx)(N.A,{start:F,processingStats:I})]})}},2026:(e,s,t)=>{t.d(s,{E:()=>a});const a=e=>new Date(e).toLocaleString()},5052:(e,s,t)=>{t(9950),t(4414)}}]);