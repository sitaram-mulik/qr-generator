"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[834],{1695:(t,e,n)=>{n.r(e),n.d(e,{default:()=>B});var a=n(9379),s=n(9950),o=n(1129),i=n(7356),l=n(615),r=n(7321),c=n(6503),u=n(6057),d=n(3711),m=n(6253),h=n(6559),x=n(9810),p=n(2438),g=n(7113),v=n(4941),f=n.n(v);n(5392);const y=n.p+"static/media/location.688d9819f1dcac68f5f36a7a231f3140.svg";var j=n(4414);const A=t=>{let{locations:e=[],centerLocation:n}=t;if(!e.length)return null;const{lat:a,lng:s}=n||e[0],o=new L.Icon({iconUrl:y,iconSize:new L.Point(40,47)});return e[0]&&(0,j.jsxs)(x.W,{style:{height:"500px",minWidth:"300px",width:"100%"},center:[a,s],zoom:2,scrollWheelZoom:!0,children:[(0,j.jsx)(p.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,j.jsx)(f(),{children:e.map(((t,e)=>(0,j.jsx)(g.p,{icon:o,position:[t.lat,t.lng]},e)))})]})};var b=n(9964),C=n(1888);const w=t=>{let{topCountries:e,topCities:n}=t;const a=(0,i.A)(),s=(0,l.A)(a.breakpoints.up("md")),o=e.map((t=>t.country)),c=e.map((t=>t.count)),u=n.map((t=>t.city||t.cities)),d=n.map((t=>t.count));return(0,j.jsxs)(C.u,{item:!0,sx:{flexDirection:"column"},size:{xs:12,md:4},children:[e.length>0&&(0,j.jsx)(r.A,{mb:4,children:(0,j.jsx)(b.E,{xAxis:[{data:c}],yAxis:[{scaleType:"band",data:o}],series:[{data:c,label:"Top Countries"}],layout:"horizontal",width:s?500:300,height:Math.max(200,40*o.length),sx:{".MuiBarElement-root":{fill:"#1976d2"}}})}),n.length>0&&(0,j.jsx)(r.A,{children:(0,j.jsx)(b.E,{xAxis:[{data:d}],yAxis:[{scaleType:"band",data:u}],series:[{data:d,label:"Top Cities"}],layout:"horizontal",width:s?500:300,height:Math.max(200,40*u.length),sx:{".MuiBarElement-root":{fill:"#388e3c"}}})})]})},S=t=>{let{selectedCampaign:e}=t;const[n,a]=(0,s.useState)([]),[i,l]=(0,s.useState)("India"),[r,c]=(0,s.useState)(!0),[u,d]=(0,s.useState)();(0,s.useEffect)((()=>{(async()=>{try{c(!0);const t=[...(await o.A.get("/locations?campaign=".concat(e))).data];a(t),c(!1)}catch(t){d("Failed to load location data ",t),c(!1)}})()}),[e]);const m=(0,s.useMemo)((()=>n.reduce(((t,e)=>{const n=e.country;return t[n]=(t[n]||0)+1,t}),{})),[n]),h=(0,s.useMemo)((()=>n.filter((t=>t.city)).reduce(((t,e)=>{const n=e.city||"unknown";return t[n]=(t[n]||0)+1,t}),{})),[n]),x=(0,s.useMemo)((()=>{const t=[];return n.forEach((e=>{if(!e.ll)return;const[n,a]=JSON.parse(e.ll);t.push({lat:n,lng:a})})),t||[]}),[n]),p=(0,s.useMemo)((()=>{const t=Object.entries(m).sort(((t,e)=>e[1]-t[1])).slice(0,5).map((t=>{let[e,n]=t;return{country:e,count:n}}));return t}),[m]),g=(0,s.useMemo)((()=>Object.entries(h).sort(((t,e)=>e[1]-t[1])).slice(0,5).map((t=>{let[e,n]=t;return{city:e,count:n}}))),[h]),v=(0,s.useMemo)((()=>{var t,e;return null===(t=p.filter((t=>"unknown"!==t.country)).sort(((t,e)=>e.count-t.count)))||void 0===t||null===(e=t[0])||void 0===e?void 0:e.country}),[p]),f=((0,s.useMemo)((()=>{var t,e;return null===(t=g.filter((t=>"unknown"!==t.city)).sort(((t,e)=>e.count-t.count)))||void 0===t||null===(e=t[0])||void 0===e?void 0:e.city}),[p]),(0,s.useMemo)((()=>{const t=n.find((t=>t.country===v));if(!t)return{};const[e,a]=JSON.parse(t.ll);return{lat:e,lng:a}}),[v]));return!r&&x.length>0&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(w,{topCountries:p,topCities:g}),(0,j.jsx)(C.u,{item:!0,size:{xs:12,md:8},children:(0,j.jsx)(A,{locations:x,centerLocation:f})})]})};var M=n(5547),k=n(900);const D=t=>{let{stats:e}=t;return(0,j.jsx)(r.A,{sx:{display:"flex",justifyContent:"space-between",width:{md:"50%",xs:"100%"},mb:{xs:2,md:0}},children:e.map(((t,e)=>(0,j.jsxs)(M.A,{sx:{p:{xs:1,sm:2},textAlign:"center",boxShadow:2,width:"24%"},children:[(0,j.jsx)(k.A,{variant:"subtitle2",sx:{fontSize:{xs:"0.8rem",sm:"1rem"}},color:"text.secondary",children:t.label}),(0,j.jsx)(k.A,{variant:"h6",sx:{fontSize:{xs:"1.2rem",sm:"1.5rem"}},fontWeight:"bold",children:t.value})]},t.label)))})};var E=n(4666),z=n(4837);const O=t=>{let{setCampaignsData:e}=t;const[n,a]=(0,s.useState)([]),[i]=(0,h.ok)(),l=i.get("campaign"),r=(0,h.Zp)();(0,s.useEffect)((()=>{c()}),[]);const c=async()=>{try{const t=await o.A.get("/campaigns");a(t.data),e(t.data)}catch(t){console.log("Failed to load campaigns ",t)}};return(0,j.jsxs)(E.A,{select:!0,label:"Select Campaign",value:l,onChange:t=>{return e=t.target.value,void r("?campaign=".concat(e||"all"));var e},sx:{minWidth:300},children:[(0,j.jsx)(z.A,{value:"all",children:"All"},"all"),n.map((t=>{let{name:e,_id:n}=t;return(0,j.jsx)(z.A,{value:e,children:e},n)}))]})},W=(0,s.memo)(O);var T=n(3673);const F=t=>{let{selectedCampaign:e}=t;const[n,a]=(0,s.useState)({labels:[],series:[]});(0,s.useEffect)((()=>{e&&i()}),[e]);const i=async()=>{try{const t=(await o.A.get("/assets?campaign="+e+"&verified=true")).data.assets,n=t=>t.reduce(((t,e)=>{const n=new Date(e.verifiedAt).toISOString().slice(0,10);return t[n]=(t[n]||0)+1,t}),{});let s=(t=>t.reduce(((t,e)=>{const n=new Date(e.verifiedAt).toISOString().slice(0,13);return t[n]=(t[n]||0)+1,t}),{}))(t),i=Object.keys(s).sort();if(i.length>100){const e=n(t);i=Object.keys(e).sort(),s=e}const l=i.map((t=>s[t])),r=t=>{let e;return 10===t.length?(e=new Date(t),e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})):13===t.length?(e=new Date(t+":00:00Z"),e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):(e=new Date(t),e.toLocaleString())};let c=i.map(r);if(c.length>=1){const t=new Date(new Date(c[0]).getTime()-36e5);c=[t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),...c],l.unshift(0)}a({labels:c,series:l})}catch(t){console.log("error ",t)}};return n.labels.length>0&&(0,j.jsx)(C.u,{size:{xs:12,md:8},children:(0,j.jsx)(T.b,{xAxis:[{scaleType:"point",data:n.labels}],series:[{data:n.series,area:!0,label:"Scanned Assets"}],height:400,sx:{".MuiLineElement-root":{strokeWidth:3},".MuiAreaElement-root":{opacity:.2}}})})};var I=n(6997);const Z=t=>{let{counts:e}=t;const[n,a]=(0,s.useState)([]),o=(0,l.A)(C.A.breakpoints.down("sm"));return(0,s.useEffect)((()=>{const{verifiedCount:t,totalCount:n}=e||{},s=t||0,o=n?Math.max(n-s,0):0;a([{label:"Scanned",value:s},{label:"Pending",value:o}])}),[e]),e.verifiedCount>0&&(0,j.jsx)(C.u,{size:{xs:12,md:4},children:(0,j.jsx)(I.r,{height:300,width:o?200:420,series:[{data:n,innerRadius:"50%",arcLabelMinAngle:20}],skipAnimation:!1})})},B=()=>{const[t,e]=(0,s.useState)({totalCount:0,downloadedCount:0,verifiedCount:0,campaignCount:0}),[n,x]=(0,s.useState)(!0),[p,g]=(0,s.useState)(null),v=((0,h.Zp)(),(0,i.A)()),[f]=((0,l.A)(v.breakpoints.down("sm")),(0,h.ok)()),y=f.get("campaign")||"all";(0,s.useEffect)((()=>{(async()=>{try{x(!0);const t=await o.A.get("/assets/statistics?campaign=".concat(y)),{totalCount:n,downloadedCount:a,verifiedCount:s}=(null===t||void 0===t?void 0:t.data)||{};e({totalCount:n,downloadedCount:a,verifiedCount:s}),x(!1)}catch(t){g("Failed to load statistics"),x(!1)}})()}),[y]);const A=(0,s.useMemo)((()=>[{label:"Campaigns",value:(null===t||void 0===t?void 0:t.campaignCount)||0},{label:"Assets",value:(null===t||void 0===t?void 0:t.totalCount)||0},{label:"Scans",value:(null===t||void 0===t?void 0:t.verifiedCount)||0},{label:"Downloads",value:(null===t||void 0===t?void 0:t.downloadedCount)||0}]),[t]),b=(0,s.useCallback)((t=>{console.log("campaignscampaigns ",t),e((e=>(0,a.A)((0,a.A)({},e),{},{campaignCount:(null===t||void 0===t?void 0:t.length)||0})))}),[]);return n?(0,j.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,j.jsx)(c.A,{})}):p?(0,j.jsx)(u.A,{severity:"error",sx:{m:3},children:p}):(0,j.jsxs)(d.A,{maxWidth:!1,sx:{p:2},children:[(0,j.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",flexDirection:{xs:"column",md:"row"}},children:[(0,j.jsx)(D,{stats:A||[]}),(0,j.jsx)(W,{setCampaignsData:b})]}),(0,j.jsxs)(m.A,{container:!0,spacing:4,sx:{mt:4},children:[(0,j.jsx)(Z,{counts:t}),(0,j.jsx)(F,{selectedCampaign:y}),(0,j.jsx)(S,{selectedCampaign:y,counts:t})]})]})}}}]);