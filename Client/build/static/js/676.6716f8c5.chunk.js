"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[4,676],{1676:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Z});var a=t(9379),n=t(9950),l=t(1129),c=t(5827),i=t(3711),o=t(8506),r=t(8796),d=t(7321),h=t(4666),x=t(6615),A=t(5547),u=t(2036),j=t(6057),m=t(5269),p=t(7631),g=t(943),f=t(3588),y=t(8767),v=t(9172),w=t(1500),S=t(5774),C=t(1751),E=t(2026),b=t(7356),R=t(615),L=t(4837),T=t(4351),k=t(5250),F=t(7844),_=t(9860),D=t(6559),I=t(4414);const P=e=>{let{filters:s,onFilterChange:t,onFilterReset:a}=e;const[i,o]=(0,n.useState)([]),[r,A]=(0,n.useState)(!1),u=(0,b.A)(),j=(0,R.A)(u.breakpoints.down("sm"));(0,D.Zp)();(0,n.useEffect)((()=>{(async()=>{try{const e=await l.A.get("/campaigns");o(e.data)}catch(e){console.log("Failed to fetch campaign options:",e)}})()}),[]);const m=()=>{A(!0)},p=()=>{A(!1)},g=(0,I.jsxs)(d.A,{sx:{display:"flex",flexDirection:j?"column":"row",alignItems:"center",gap:2,mb:2,height:{md:"50px"}},children:[(0,I.jsxs)(h.A,{select:!0,label:"By Campaign",value:s.campaign||"",onChange:e=>t("campaign",e.target.value),sx:{minWidth:200},children:[(0,I.jsx)(L.A,{value:"",children:"All Campaigns"}),i.map((e=>(0,I.jsx)(L.A,{value:e.name,children:e.name},e.id)))]}),(0,I.jsxs)(h.A,{select:!0,label:"By Scan",value:s.verified||"",onChange:e=>t("verified",e.target.value),sx:{minWidth:200},children:[(0,I.jsx)(L.A,{value:"",children:"All"}),(0,I.jsx)(L.A,{value:"true",children:"Scanned"}),(0,I.jsx)(L.A,{value:"false",children:"Not scanned"})]}),(0,I.jsxs)(h.A,{select:!0,label:"By Downloads",value:s.downloaded||"",onChange:e=>t("downloaded",e.target.value),sx:{minWidth:200},children:[(0,I.jsx)(L.A,{value:"",children:"All"}),(0,I.jsx)(L.A,{value:"true",children:"Downloaded"}),(0,I.jsx)(L.A,{value:"false",children:"Not downloaded"})]}),(0,I.jsx)(h.A,{label:"Created After",type:"date",value:s.createdAfter||"",onChange:e=>t("createdAfter",e.target.value),sx:{minWidth:200},InputLabelProps:{shrink:!0}})," ",(0,I.jsx)(x.A,{onClick:()=>{a()},variant:"contained",startIcon:(0,I.jsx)(F.A,{}),sx:{height:{md:"100%"}},children:"Reset"})]});return j?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(x.A,{variant:"outlined",onClick:m,sx:{mb:2},children:"Filters"}),(0,I.jsxs)(c.A,{open:r,onClose:p,fullWidth:!0,maxWidth:"sm",children:[(0,I.jsx)(T.A,{children:"Filters"}),(0,I.jsxs)(k.A,{children:[g,(0,I.jsx)(d.A,{sx:{display:"flex",justifyContent:"center"},children:(0,I.jsx)(x.A,{startIcon:(0,I.jsx)(_.A,{}),onClick:p,children:"Close"})})]})]})]}):g};var U=t(8728),N=t.n(U),W=t(5874),O=t(9872),H=t(5532),z=t(7004),B=t(6195);const K={campaign:"",verified:"",downloaded:"",createdAfter:""};function V(e,s){switch(s.type){case"SET_FILTERS":return(0,a.A)((0,a.A)({},e),s.payload);case"RESET_FILTERS":return(0,a.A)({},K);default:return e}}const M=(0,B.Ay)(c.A)((e=>{let{theme:s}=e;return{"& .MuiDialogContent-root":{padding:s.spacing(2)},"& .MuiDialogActions-root":{padding:s.spacing(1)}}}));const Z=function(){const[e,s]=(0,n.useState)(!0),[t,c]=(0,n.useState)(null),[b,R]=(0,n.useState)([]),[L,T]=(0,n.useState)([]),[k,F]=(0,n.useState)(!1),[_,U]=(0,n.useState)(null),[B,Z]=(0,n.useReducer)(V,K),[G,J]=(0,n.useState)(!1),[q,Q]=(0,n.useState)(null),X=(0,D.zy)(),Y=(0,D.Zp)(),{fetchUserDetails:$}=(0,n.useContext)(H.c);(0,n.useEffect)((()=>{const e=new URLSearchParams(X.search),s=Object.fromEntries(e.entries());Z({type:"SET_FILTERS",payload:(0,a.A)({},s)})}),[X.search]),(0,n.useEffect)((()=>{ee()}),[B]);const ee=async()=>{try{const e=new URLSearchParams(X.search),t=await l.A.get("/assets?".concat(e.toString()));R(t.data.assets),T(t.data.count),s(!1)}catch(e){c("Failed to load code list "),s(!1)}},se=(0,n.useCallback)((()=>{Z({type:"RESET_FILTERS"}),Y("/assets")}),[]);return e?(0,I.jsx)(i.A,{maxWidth:"lg",sx:{mt:4},children:(0,I.jsx)(o.A,{})}):(0,I.jsxs)(i.A,{maxWidth:"lg",sx:{mt:4},children:[(0,I.jsxs)(r.A,{sx:{p:3},children:[(0,I.jsxs)(d.A,{sx:{mb:4},children:[(0,I.jsx)(P,{filters:B,onFilterChange:(e,s)=>{const t=new URLSearchParams(X.search);void 0===typeof s||""===s?t.delete(e):t.set(e,s),Y("".concat(X.pathname,"?").concat(t.toString()),{replace:!0})},onFilterReset:se}),(0,I.jsxs)(d.A,{sx:{mb:1},align:"left",children:[(0,I.jsx)(h.A,{label:"Download count",type:"number",value:L,onChange:e=>T(e.target.value),size:"small",sx:{mb:2,mr:2}}),(0,I.jsx)(x.A,{variant:"contained",startIcon:(0,I.jsx)(C.A,{}),onClick:async()=>{F(!0),U(null);try{var e;const s=new URLSearchParams(X.search);s.append("count",L);const t=(await(0,l.A)("/assets/download?".concat(s.toString()),{responseType:"blob"})).data,a=window.URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="".concat(B.campaign||"all","-assets.zip"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a);const c=await N().loadAsync(t),i=await(null===(e=c.file("summary.json"))||void 0===e?void 0:e.async("string"));if(i){const e=JSON.parse(i);F(!1),U(e)}$()}catch(t){return c("Failed to download assets ",t),F(!1),void $()}},children:"Download assets"})]}),_&&!k&&(0,I.jsx)(A.A,{children:(0,I.jsx)(u.A,{children:(0,I.jsx)(d.A,{sx:{mb:2},children:(0,I.jsxs)(j.A,{severity:_.failed>0?"warning":"success",sx:{mt:2},children:["Last download status: ",_.success," successful,"," ",_.failure," failed (Total: ",_.total,")"]})})})})]}),(0,I.jsx)(m.A,{component:d.A,sx:{maxHeight:440},children:(0,I.jsxs)(p.A,{stickyHeader:!0,"aria-label":"assets table",size:"small",children:[(0,I.jsx)(g.A,{children:(0,I.jsxs)(f.A,{children:[(0,I.jsx)(y.A,{children:"Id"}),(0,I.jsx)(y.A,{children:"Campaign"}),(0,I.jsx)(y.A,{children:"Verified at"}),(0,I.jsx)(y.A,{children:"Downloads"}),(0,I.jsx)(y.A,{children:"Created at"}),(0,I.jsx)(y.A,{align:"right",children:"View"})]})}),(0,I.jsx)(v.A,{children:b.map((e=>(0,I.jsxs)(f.A,{hover:!0,children:[(0,I.jsx)(y.A,{component:"th",scope:"row",children:e.code}),(0,I.jsx)(y.A,{component:"th",scope:"row",children:e.campaign}),(0,I.jsx)(y.A,{component:"th",scope:"row",children:e.verifiedAt?(0,E.E)(e.verifiedAt):"Not verified"}),(0,I.jsx)(y.A,{component:"th",scope:"row",children:e.downloads}),(0,I.jsx)(y.A,{component:"th",scope:"row",children:(0,E.E)(e.createdAt)}),(0,I.jsx)(y.A,{align:"right",children:(0,I.jsx)(w.A,{color:"primary",onClick:()=>{Q(e.code),J(!0)},children:(0,I.jsx)(O.A,{})})})]},e.code)))})]})}),t&&(0,I.jsx)(j.A,{severity:"error",sx:{mt:2},children:t}),0===b.length&&(0,I.jsx)(j.A,{severity:"info",sx:{mt:2},children:"No matching assets found for this filter."})]}),(0,I.jsx)(W.A,{start:k,processingStats:_,operationCount:L}),(0,I.jsxs)(M,{open:G,onClose:()=>J(!1),children:[(0,I.jsx)(w.A,{"aria-label":"close",onClick:()=>J(!1),sx:e=>({position:"absolute",right:8,top:8,color:e.palette.grey[500]}),children:(0,I.jsx)(S.A,{})}),q&&(0,I.jsx)(z.default,{code:q})]})]})}},2026:(e,s,t)=>{t.d(s,{E:()=>a});const a=e=>new Date(e).toLocaleString()},7004:(e,s,t)=>{t.r(s),t.d(s,{default:()=>u});var a=t(9950),n=t(6559),l=t(1129),c=t(3711),i=t(8796),o=t(7321),r=t(1393),d=t(4755),h=t(1106),x=t(2026),A=t(4414);const u=function(e){let{code:s}=e;const{code:t}=(0,n.g)(),u=s||t,[j,m]=(0,a.useState)(null),[p,g]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(async()=>{try{const e=(await l.A.get("/assets/".concat(u))).data;console.log("details ",e),null!==e&&void 0!==e&&e.code&&m(e),g(!1)}catch(e){setError(e.message),g(!1)}})()}),[u]),p?(0,A.jsx)("div",{className:"loading",children:"Loading..."}):(0,A.jsx)(c.A,{sx:{mt:6,mb:2},children:(null===j||void 0===j?void 0:j.imagePath)&&(0,A.jsxs)(i.A,{elevation:3,children:[(0,A.jsx)("img",{src:"".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL||"","/api/assets/pattern/").concat(j.code),alt:"Generated Code",className:"full-image",style:{width:"100%"}}),(0,A.jsxs)(o.A,{sx:{display:{md:"flex"}},children:[(0,A.jsxs)(r.A,{children:[(0,A.jsx)(d.Ay,{children:(0,A.jsx)(h.A,{primary:"Campaign Name",secondary:j.campaign})}),(0,A.jsx)(d.Ay,{children:(0,A.jsx)(h.A,{primary:"Created time",secondary:(0,x.E)(j.createdAt)})}),(0,A.jsx)(d.Ay,{children:(0,A.jsx)(h.A,{primary:"Scanned time",secondary:j.verifiedAt?(0,x.E)(j.verifiedAt):"Not scanned"})})]}),(0,A.jsxs)(r.A,{children:[(0,A.jsx)(d.Ay,{children:(0,A.jsx)(h.A,{primary:"Total downloads",secondary:j.downloads})}),j.downloadedAt&&(0,A.jsx)(d.Ay,{children:(0,A.jsx)(h.A,{primary:"Last download time",secondary:(0,x.E)(j.downloadedAt)})})]})]})]})})}}}]);