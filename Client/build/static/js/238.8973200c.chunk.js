"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[238],{1238:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var a=s(9950),n=s(1129),i=s(6559),r=s(5532),c=s(7321),l=s(6503),o=s(3711),d=s(8796),u=s(4666),h=s(4837),m=s(6615),p=s(6057),x=s(4414);const g=(0,s(8395).A)((0,x.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline");var v=s(5874);const j=()=>{const[e,t]=(0,a.useState)(1),[s,j]=(0,a.useState)([]),[f,y]=(0,a.useState)(""),[A,C]=(0,a.useState)(!1),[S,b]=(0,a.useState)(!0),[w,k]=(0,a.useState)(""),[F,I]=(0,a.useState)([]),[N,q]=(0,a.useState)(null),[D,G]=(0,a.useState)(0),[M,z]=(0,a.useState)(null),{fetchUserDetails:H}=(0,a.useContext)(r.c),P=(0,i.Zp)();(0,a.useEffect)((()=>{U().finally((()=>{b(!1)}))}),[]);const U=async()=>{try{const t=await n.A.get("/campaigns");I(t.data);const s=new URLSearchParams(window.location.search).get("campaign");var e;if(s)k(s);else k((null===(e=t.data[0])||void 0===e?void 0:e.name)||"")}catch(t){y("Failed to load campaigns")}},W=async(e,t,s)=>{try{return(await n.A.post("assets/generate",{count:e,campaignName:w})).data.codes}catch(a){throw console.log("Batch processing error:",a),a}};return S?(0,x.jsx)(c.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,x.jsx)(l.A,{})}):(0,x.jsx)(o.A,{maxWidth:"md",sx:{mt:4},children:(0,x.jsxs)(d.A,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,x.jsx)("h2",{children:"Generate unique assets for your products"}),(0,x.jsxs)(x.Fragment,{children:[F.length>0?(0,x.jsx)(c.A,{sx:{mb:2},children:(0,x.jsx)(u.A,{select:!0,label:"Select Campaign",value:w,onChange:e=>k(e.target.value),required:!0,sx:{minWidth:300},children:F.map((e=>{let{name:t}=e;return(0,x.jsx)(h.A,{value:t,children:t},t)}))})}):(0,x.jsxs)("div",{className:"no-campaigns",children:[(0,x.jsx)("p",{children:"No campaigns found."}),(0,x.jsx)(m.A,{type:"button",variant:"contained",startIcon:(0,x.jsx)(g,{}),onClick:()=>{P("/campaigns/action")},children:"Create Your First Campaign"})]}),(0,x.jsxs)(c.A,{sx:{mt:2,mb:2},children:[(0,x.jsx)(u.A,{type:"number",id:"count",value:e,onChange:e=>t(e.target.value),min:"1",max:(null===N||void 0===N?void 0:N.remaining)||1e4,required:!0,style:{width:300}}),N&&(0,x.jsxs)("small",{className:"input-help",children:["Max: ",N.remaining]})]}),(0,x.jsx)(m.A,{color:"inherit",variant:"primary",startIcon:(0,x.jsx)(g,{}),disabled:A||!F.length,onClick:async t=>{t.preventDefault(),y(""),j([]),z(null);const s=parseInt(e);if(s<1)y("Please enter a number between 1 and 100000");else if(N&&s>N.remaining)y("Cannot generate ".concat(s," assets. You only have ").concat(N.remaining," assets remaining in your limit."));else try{C(!0),G(0),z({total:s,processed:0,success:0,failed:0});const e=20;let t=0,a=0,n=0;const r=[];for(;t<s;){const c=Math.min(e,s-t);try{const e=await W(c);r.push(...e),a+=e.length}catch(i){n+=c,console.log("Failed to process batch:",i)}t+=c;G(t/s*100),z({total:s,processed:t,success:a,failed:n})}j(r),setTimeout((()=>{C(!1),G(0)}),1e3)}catch(i){var a,n;y((null===(a=i.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.error)||"Failed to generate assets"),C(!1),G(0)}finally{H()}},children:A?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l.A,{size:20,color:"inherit",sx:{mr:1}}),"Generating..."]}):"Generate Assets"})]}),(0,x.jsx)(v.A,{start:A,progress:D,processingStats:M,onClose:()=>{j([])},operationCount:e}),f&&(0,x.jsx)(p.A,{severity:"error",sx:{mb:3,mt:2},children:f})]})})}}}]);