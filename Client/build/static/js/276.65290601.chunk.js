"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[276],{8276:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var n=s(9950),a=s(1129),i=s(6559),l=s(5532),r=s(7321),c=s(6503),o=s(3711),d=s(8796),u=s(4666),h=s(4837),m=s(6615),x=s(7850),p=s(6057),g=s(8395),j=s(4414);const v=(0,g.A)((0,j.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline");var y=s(5874);const A=["geopattern","Polygons"],f=()=>{const[e,t]=(0,n.useState)(1),[s,g]=(0,n.useState)(A[0]),[f,b]=(0,n.useState)(500),[C,S]=(0,n.useState)(!0),[w,I]=(0,n.useState)([]),[k,F]=(0,n.useState)(""),[P,z]=(0,n.useState)(!1),[N,q]=(0,n.useState)(!0),[D,G]=(0,n.useState)(""),[M,W]=(0,n.useState)([]),[H,T]=(0,n.useState)(null),[U,Y]=(0,n.useState)(0),[B,E]=(0,n.useState)(null),{fetchUserDetails:L}=(0,n.useContext)(l.c),O=(0,i.Zp)();(0,n.useEffect)((()=>{R().finally((()=>{q(!1)}))}),[]);const R=async()=>{try{const t=await a.A.get("/campaigns");W(t.data);const s=new URLSearchParams(window.location.search).get("campaign");var e;if(s)G(s);else G((null===(e=t.data[0])||void 0===e?void 0:e.name)||"")}catch(t){F("Failed to load campaigns")}},Z=async e=>{try{return(await a.A.post("assets/generate",{count:e,campaignName:D,patternType:s,size:f,includePattern:C})).data.codes}catch(t){throw console.log("Batch processing error:",t),t}};return N?(0,j.jsx)(r.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,j.jsx)(c.A,{})}):(0,j.jsx)(o.A,{maxWidth:"md",sx:{mt:4},children:(0,j.jsxs)(d.A,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,j.jsx)("h2",{children:"Generate unique assets for your products"}),(0,j.jsxs)(j.Fragment,{children:[M.length>0?(0,j.jsx)(r.A,{sx:{mb:2},children:(0,j.jsx)(u.A,{select:!0,label:"Select Campaign",value:D,onChange:e=>G(e.target.value),required:!0,sx:{minWidth:300},children:M.map((e=>{let{name:t}=e;return(0,j.jsx)(h.A,{value:t,children:t},t)}))})}):(0,j.jsxs)("div",{className:"no-campaigns",children:[(0,j.jsx)("p",{children:"No campaigns found."}),(0,j.jsx)(m.A,{type:"button",variant:"contained",startIcon:(0,j.jsx)(v,{}),onClick:()=>{O("/campaigns/action")},children:"Create Your First Campaign"})]}),(0,j.jsxs)(r.A,{sx:{mt:2,mb:2},children:[(0,j.jsx)(u.A,{type:"number",id:"count",label:"Count",value:e,onChange:e=>t(e.target.value),min:"1",max:(null===H||void 0===H?void 0:H.remaining)||1e4,required:!0,style:{width:300}}),H&&(0,j.jsxs)("small",{className:"input-help",children:["Max: ",H.remaining]})]}),(0,j.jsxs)(r.A,{sx:{mb:1,display:"flex",justifyContent:"flex-start",alignItems:"center",width:300},children:[(0,j.jsx)(x.A,{checked:C,onChange:()=>S((e=>!e)),sx:{pl:0}}),(0,j.jsx)("label",{children:"Include pattern image"})]}),C&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(r.A,{sx:{mt:2,mb:2},children:(0,j.jsx)(u.A,{select:!0,label:"Pattern type",value:s,onChange:e=>g(e.target.value),sx:{minWidth:300},children:A.map((e=>(0,j.jsx)(h.A,{value:e,children:e},e)))})}),(0,j.jsx)(r.A,{sx:{mt:2,mb:3},children:(0,j.jsx)(u.A,{type:"number",label:"Size in pixel",id:"size",value:f,onChange:e=>b(e.target.value),slotProps:{htmlInput:{min:100,max:500}},style:{width:300}})})]}),(0,j.jsx)(m.A,{color:"inherit",variant:"primary",startIcon:(0,j.jsx)(v,{}),disabled:P||!M.length,onClick:async t=>{t.preventDefault(),F(""),I([]),E(null);const s=parseInt(e);if(s<1||s>1e4)return void F("Please enter a number between 1 and 10000");const n=parseInt(f);if(n<100||n>800)F("Please enter size between 100 and 800");else if(H&&s>H.remaining)F("Cannot generate ".concat(s," assets. You only have ").concat(H.remaining," assets remaining in your limit."));else try{z(!0),Y(0),E({total:s,processed:0,success:0,failed:0});const e=100;let t=0,n=0,a=0;const i=[];for(;t<s;){const r=Math.min(e,s-t);try{const e=await Z(r);i.push(...e),n+=e.length}catch(l){a+=r,console.log("Failed to process batch:",l)}t+=r;Y(t/s*100),E({total:s,processed:t,success:n,failed:a})}I(i),setTimeout((()=>{z(!1),Y(0)}),1e3)}catch(l){var a,i;F((null===(a=l.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.error)||"Failed to generate assets"),z(!1),Y(0)}finally{L()}},children:P?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(c.A,{size:20,color:"inherit",sx:{mr:1}}),"Generating..."]}):"Generate Assets"})]}),(0,j.jsx)(y.A,{start:P,progress:U,processingStats:B,onClose:()=>{I([]),O("/assets")},operationCount:e}),k&&(0,j.jsx)(p.A,{severity:"error",sx:{mb:3,mt:2},children:k})]})})}}}]);